### C结构体

C数组允许定义可存储相同类型据项的变量，C结构是C编程中另一种用户自定义的可用的数据类型，它允许你存储不同类型的数据项。

> 定义结构

为了定义结构，必须使用struct语句，struct语句定义了一个包含多个成员的新的数据类型，struct语句的格式如下：

```
struct [structure tag]
{
	member definition;
	member definition;
	...
	member definition;
}[one or more structure variables];
```

structure tag是可选的，每个member definition是标准的变量定义，比如int i;或者float f;或者是其他有效的变量定义。在结构定义的末尾，最后一个分号之前，可以指定一个或多个结构变量，这是可选的，下面是声明Book结构的方式：

```
struct Books
{
	char title[50];
	char author[50];
	char subject[100];
	int book_id;
} book;
```

> 访问结构成员

为了访问结构成员，我们使用成员访问运算符(.)。成员访问运算符是结构变量和我们要访问的结构成员之间的一个句号。


> 结构作为函数参数

可以把结构作为函数参数，传参方式与其他类型的变量或指针类似。


> 指向结构的指针

可以定义指向结构的指针，方式与定义指向其他类型变量的指针相似。


> 位域

有些信息在存储时，并不需要占用一个完整的字节，而只需占几个或一个二进制位。例如在存放一个开关量时，只有0和1两种状态，用1位二进位即可。为了节省存储空间，并使处理简便，C语言又提供了一种数据结构，称为“位域”或“位段”。所谓“位域”是把一个字节中的二进制位划分为几个不同的区域，并说明每个区域的位数。每个域有一个域名，允许在程序中按域名进行操作。这样就可以把几个不同的对象用一个字节的二进制位域来表示。

##### 位域的定义和位域变量的说明

位域定义与结构定义相仿，其形式为：

```
struct 位域结构名
{
	位域列表
};
```

其中位域列表的形式为：

`类型说明符 位域名: 位域长度`

例如：

```
struct bs
{
	int a:8;
	int b:2;
	int c:6;
} data;
```

说明data为bs变量，共占两个字节。其中位域a占8位，位域占2位，位域c占6位。

再看一个实例：

```
struct packed_struct
{
	unsigned int f1:1;
	unsigned int f2:1;
	unsigned int f3:1;
	unsigned int f4:1;
	unsigned int type:4;
	unsigned int my_int:9;
} pack;
```

这里，packed_struct包含了6个成员：四个1位的标识符f1...f4，一个4位的type和一个9位的my_int。

说明：

一个位域必须存储在同一个字节中，不能跨两个字节。如果一个字节所剩空间不够存放另一位域时，应从下一单元起存放该位域。也可以有意使某位域从下一单元开始。例如：

```
struct bs
{
	unsigned a:4;
	unsigned  :4; // 空域
	unsigned b:4; // 从下一单元开始存放
	unsigned c:4;
};
```

在这个位域定义中，a占第一字节的4位，后4位填0表示不使用，b从第二字节开始，占用4位，c占用4位。


位域可以是无名位域，这时它只用来作填充或调整位置。无名的位域是不能使用的。例如：

```
struct k
{
	int a:1;
	int  :2; // 该2位不能使用
	int b:3;
	int c:2;
};
```

从以上分析可以看出，位域在本质上就是一种结构类型，不过其成员是按二进制位分配的。

##### 位域的使用

位域的使用和结构成员的使用相同，其一般形式为：

```
位域变量名.位域名
位域变量名->位域名
```

位域允许用各种格式输出。


