### 文件的输入与输出

> 什么是文件

文件有不同的类型，在程序设计中，主要用到两种文件：
1. 程序文件：包括源程序文件（后缀为.c），目标文件（后缀为.o）以及可执行文件等。这种文件里的内容是程序代码。

2. 数据文件：文件的内容不是程序，而是供程序运行时读写的数据，包括在程序运行过程中输出到磁盘的数据和在程序运行过程中供读入的数据，如全班学生的成绩数据、货物交易的数据等。

> 文件的分类

根据数据的组织形式，数据文件可分为ASCII文件和二进制文件。数据在内存中都是以二进制形式存储的，如果不加转换地输出到外存，就是二进制文件，可以认为就是内存数据的映像，称为映像文件。如果要求在外存中以ASCII码形式存储，则需要在存储前进行转换。ASCII文件又称为文本文件，每一个字节放一个字符的ASCII码。

用ASCII码形式输出时字节与字符一一对应，一个字节代表一个字符，因而便于对字符进行逐个处理，也便于输出字符。但一般占存储空间较多，而且要花费转换时间。用二进制形式输出数值，可以节省外存空间和转换时间，把内存中的存储单元中的内容原封不动地输出到外存磁盘上，此时一个字节并不一定代表一个字符。

> 打开和关闭文件

对文件读写之前应该“打开”该文件，使用结束之后“关闭”文件。实际上，所谓的打开文件是指为文件建立相应的信息区（用来存放有关文件的信息）和文件缓冲区（用来暂时存放输入输出的数据）。

##### fopen函数打开数据文件

fopen函数的调用方式为`fopen(文件名,使用文件的方式);

```
fopen("a1", "r");
```

表示要打开名字为“a1”的文件，使用文件的方式为“读入”（r代表read，即读入）。fopen函数的返回值是指向a1文件的指针（即a1文件信息区的起始地址）。通常将fopen函数的返回值赋给一个指向文件的指针变量。

```
FILE *fp;
fp = fopen("a1", "r");
```

这样fp就和文件a1相联系了，或者说fp指向了a1文件。

##### fclose函数关闭数据文件

使用完一个文件后应该关闭它，以防止它被误用。“关闭”就是撤销文件信息区和文件缓冲区，使文件指针变量不再指向该文件。

fclose函数的调用方式：fclose(文件指针)。

```
fclose(fp);
```

如果不关闭文件将会丢失数据，应当养成在程序终止之前关闭所有文件的习惯。


> 文件的输入与输出

##### 顺序读写数据文件

文件打开之后，就可以对它进行读写了。在顺序写时，先写入的数据存放在文件中前面的位置，后写入的数据存放在文件中后面的位置。在顺序读时，读数据的顺序和数据在文件中的物理顺序是一致的。顺序读写需要用库函数实现。

|函数名|调用形式|功能|返回值|
| :-- |  :--  |:--| :-- |
| fgetc | fgetc(fp) | 从fp指向的文件读入一个字符 | 成功，带回所读的字符；失败则返回文件结束标志EOF（即-1） |
| fputc | fputc(ch, fp) | 把字符ch写到文件指针变量fp所指向的文件中 | 输出成功，返回值就是输出的字符；输出失败，则返回EOF（即-1） |

**说明：fgetc的第一个字母f代表文件（file），中间的get表示获取，最后一个c表示字符char。fputc也类似。**

##### 随机读写数据文件

对文件进行顺序读写比较容易理解，也容易操作，但是效率不高。比如文件中存放了一个城市几百万人的资料，我们想要查找某一个人，按照顺序读写需要从第一个数据逐个读入，等待的时间是不能忍受的。为了解决这个问题，可移动文件内部的位置指针到需要读写的位置，再进行读写，这种读写被称为随机读写。随机访问不是按数据在文件中的物理位置次序进行读写，而是可以对任何位置上的数据进行访问，显然这种方法比顺序访问的效率高得多。

**实现随机读写的关键是要按要求移动位置指针，也就是文件的定位。**

移动文件内部的位置指针的函数主要有两个，即rewind()和fseek()。

rewind函数的调用形式为：rewind(文件指针); 它的功能是把文件内部的位置指针移动文件开头。

fseek函数用来移动文件内部的位置指针，其调用形式为：fseek(文件指针, 位移量, 起始点);。其中：“文件指针”指向被移动的文件；“位移量”表示移动的字节数，要求位移量是long型数据，以便在文件长度大于64KB时不会出错，当用常量表示位移量时，要求加后缀“L”；“起始点”表示从何处开始计算位移量，规定的起始点有三种：文件首，当前位置和文件尾。

其表示方法如下表：

|  起始点  | 表示符号 | 数字表示 |
|  :--     | :--      | :--      |
|  文件首  | SEEK_SET | 0        |
| 当前位置 | SEEK_CUR | 1        |
| 文件末尾 | SEEK_END | 2        |

例如：`fseek(fp, 100L, 0);`其意义是把位置指针移到离文件首100个字节处。

还要说明的是fseek函数一般用于二进制文件。在文本文件中由于要进行转换，故往往计算的位置会出现错误。
