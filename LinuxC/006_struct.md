# 结构体

之前使用的大多数数据类型都具有单一的值，如整数、字符、布尔值、浮点数，这些可称为基本数据类型(Primitive Type)。但字符串
是一个例外，它由很多字符组成，像这种由基本类型组成的数据类型称为复合类型(Compound Type)，正如表达式和语句有组合规则一
样，由基本类型组成复合类也有一些组合规则。复合数据类型一方面可以从整体上当作一个数据使用，另一方面也可以分别访问它的各
组成单元，复合数据类型的这种两面性提供了一种数据抽象(Data Abstraction)的方法。SICP(Struct and Interpretation Of Computer Programs)
指出，在学习一门编程语言时，要特别注意以下三方面：

1.	这门语言提供了哪些 Primitive，比如基本数据类型，比如基本的运算符、表达式和语句；

2.	这门语言提供了哪些组合规则，比如复合数据类型，比如表达式和语句的组合规则；

3.	这门语言提供了哪些抽象机制，比如数据抽象和过程抽象(Procedure Abstraction)；

过程抽象最简单的形式，就是把一组语句用一个函数名封装起来，当作一个整体使用。以下来学习了下数据类型的组合和抽象。

用 C 语言表示一个复数。如果从直角坐标系来看，复数由实部和虚部组成，如果从极坐标系来看，复数由模和辐角组成，两种坐标系
可以相互转换，如下图：

![struct.complex.png](static/struct.complex.png)

比如用实部和虚部表示一个复数，可以采用两个 double 类型组成的结构体：

```
struct complex_struct {
	double x, y;
};
```

complex_struct 是标识符，命名规则和变量一样，但它不表示一个变量，而表示一个类型，这种标识符在 C 语言称为 Tag，
`struct complex_struct {doublex, y; }`整个可以看作一个类型名，就像 int 或 double 一样，只不过它是一个复合类型。可以如下
定义复数变量：

```
struct struct complex_struct z3, z4;
```

也可以在定义结构体类型的同时定义变量，也可以不必写 Tag，如：

```
struct {
	double x, y;
} z1, z2;
```

但这样就没有办法再次引用这个结构体类型了，因为它没有名字。可以用`.`运算符来访问结构体成员，成员的存储空间是相邻的，合在
一起组成复数变量的存储空间，[struct.c](src/struct.c)。

上例中变量 x 和变量 z 的成员 x 的名字并不冲突，它们属于不同的命名空间(Name Space)。Tag 也可以定义在函数外面，就像全局变
量一样，结构体变量也可以在定义时初始化，如果初始化的数据比结构体的成员少，未指定的成员就像未初始化的变量一样。

**注意**：使用基本数据类型时，能用来初始化的表达式就能用来赋值，在这一点上结构体的语法规则有点不同。结构体类型的值用在表
达式中有很多限制，比如`+-*/`等算术运算符和`&&`、`||`、`!`等逻辑运算符都不能作用于结构体类型，if、while 的控制表达式的值
也不能是结构体类型。严格来说，可以做算术运算的类型称为算术类型(Arithmetic Type)，包括整型和浮点型。可以做逻辑与、或、非
运算的操作数或者 if、for、while 的控制表达式的类型称为标量类型(Scalar Type)，包括算术类型和指针类型。

结构体不能如下赋值：

```
// 这是错误的
struct complex_struct z1;
z1 = { 3.0, 4.0 };
```

结构体类型之间用赋值运算符是允许的，用一个结构体初始化另一个结构体也是允许的：

```
struct complex_struct z1 = { 3.0, 4.0 };
struct complex_struct z2 = z1;
z1 = z2;
```
