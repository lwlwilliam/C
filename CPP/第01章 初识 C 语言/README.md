# 初识 C 语言

## 起源

1972 年，丹尼斯•尼奇(Dennis Ritch)和肯•汤普逊(Ken Thompson)在开发 UNIX 操作系统时设计了 C 语言。C 语言不完全是里奇突发奇想而来，
他是在 B 语言（汤普逊发明）的基础上进行设计。C 语言设计的初衷是将其作为程序员使用的一种编程工具，因此，其主要目标是成为有用的语言。

虽然绝大多数语言都以实用为目标，但是通常也会考虑其他方面。例如，Pascal 的主要目标是为更好地学习编程原理提供扎实的基础，而 BASIC 的
主要目标是开发出类似英文的语言，让不熟悉计算机的学生轻松学习编程。这些目标固然很重要，但是随着计算机的迅猛发展，它们已经不是主流语
言。然而，最初为程序员设计开发的 C 语言，现在已成为首选的编程语言之一。

## 选择 C 语言的理由

1.  设计特性

    C 是一门流行的语言，整合了计算机科学理论和实践的控制特性。C 语言的设计理念让用户能轻松地完成自顶向下的规划、结构化编程和模块化设计。
    因此，用 C 语言编写的程序更易懂、更可靠。

2.  高效性

    C 是高效的语言。在设计上，它充分利用了当前计算机的优势，因此 C 程序相对更紧凑，而且运行速度很快。实际上，C 语言具有通常是汇编语言才
    具有的微调控制能力（汇编语言是为特殊的中央处理单元设计的一系列内部指令，使用助词符来表示；不同的 CPU 系列使用不同的汇编语言），可以
    根据具体情况微调程序以获得最大运行速度或最有效地使用内存。

3.  可移植性

    C 是可移植的语言。这意味着，在一种系统中编写的 C 程序稍作修改或不修改就能在其他系统运行。如需修改，也只需简单更改主程序头文件中的少许
    项即可。但是要注意，程序中针对特殊硬件设备（如，显示监视器）或操作系统特殊功能编写的部分，通常是不可移植的。

4.  强大而灵活

    C 语言功能强大且灵活。例如，功能强大且灵活的 UNIX 操作系统，大部分是用 C 语言写的；其它语言的许多编译器和解释器都是用 C 语言编写的。
    因此，在 UNIX 机上使用 FORTRAN 时，最终是由 C 程序生成最后的可执行程序。C 程序可以用于解决物理学和工程学的问题，甚至可用于制作电影的
    动画特效。

5.  面向程序员

    C 语言是为了满足程序员的需求而设计的，程序员利用 C 可以访问硬件、操控内存中的位。C 语言有丰富的运算符，能让程序员简洁地表达自己的意图。
    C 没有 Pascal 严谨，但是却比 C++ 的 限制多。这样的灵活性既是优点也是缺点。优点是，许多任务用 C 来处理都非常简洁（如，转换数据的格式）；
    缺点是，可能会犯一些莫名其妙的错误，这些错误不可能在其它语言中出现。C 语言在提供更多自由的同时，也让使用者承担了更大的责任。

    另外，大多数 C 实现都有一个大型的库，包含众多有用的 C 函数。

6.  缺点

    人无完人，金无足赤。C 语言也有一些缺点。例如，前面提到的，要享受用 C 语言自由编程的乐趣，就必须承担更多的责任。特别是，C 语言使用指针，
    而涉及指针的编程错误往往难以察觉。有句话说得发，想拥有自由就必须时刻保持警惕。

## C 语言的应用范围

早在 20 世纪 80 年代，C 语言就已经成为小型计算机（UNIX 系统）使用的主流语言。从那以后，C 语言的应用范围扩展到微型机（个人计算机）和
大型机（庞然大物）。许多软件公司都用 C 语言来开发文字处理程序、电子表格、编译器和其它产品。

C++ 在 C 语言的基础上嫁接了面向对象编程工具。C++ 几乎是 C 的超集，这意味着任何 C 程序差不多就是一个 C++ 程序。学习 C 语言，也相当于
学习了许多 C++ 的知识。

特别，C 语言已成为嵌入式系统编程的流行语言。也就是说，越来越多的汽车、照相机、DVD 播放机和其它现代化设备的微处理器都用 C 语言进行编程。
除此之外，C 语言还从长期被 FORTRAN 独占的科学编程领域分得一杯羹。最终，作为开发操作系统的卓越语言，C 在 Linux 开发中扮演着极其重要的角色。

## 计算机能做什么

现代计算机由多种部件构成。`中央处理单元(CPU)`承担绝大部分的运算工作。`随机存取内存(RAM)`是存储程序和文件的工作区；而永久内存存储设备
（过去一般指机械硬盘，现在还包括固态硬盘）即使在关闭计算机后，也不会丢失之前储存的程序和文件。另外，还有各种外围设备（如，键盘、鼠标、
触摸屏、监视器）提供人与计算机之间的交互。CPU 负责处理程序。

CPU 从内存中获取并执行一条指令，然后再从内存中获取并执行下一条指令，诸如此类（一个吉赫兹的 CPU 一秒钟能重复这样的操作大约十亿次，
因此，CPU 能以惊人的速度从事枯燥的工作）。CPU 有自己的小工作区——由若干个 **寄存器** 组成，每个寄存器都可以储存一个数字。一个寄存器
储存下一条指令的内存地址，CPU 使用该地址来获取和更新下一条指令。在获取指令后，CPU 在另一个寄存器中储存该指令，并更新第 1 个寄存器
储存下一条指令的地址。CPU 能理解的指令有限（这些指令的集合叫做 **指令集**）。而且，这些指令相当具体，其中的许多指令都是用于请求计
算机把一个数字从一个位置移动到另一个位置。例如，从内存移动到寄存器。

有两个有趣的知识。其一，储存在计算机中的所有内容都是数字。计算机以数字形式储存数字和字符（如，在文本文档中使用的字母）。每个字符都
有一个数字码。计算机载入寄存器的指令也以数字形式储存，指令集中的每条指令都有一个数字码。其二，计算机程序最终必须以数字指令码（即，
**机器语言**）来表示。

简而言之，计算机的工作原理是：如果希望计算机做某些事，就必须为其提供特殊的指令列表（程序），确切地告诉计算机要做的事以及如何做。你必须
用计算机能直接明白的语言（机器语言）创建程序。这是一项繁琐、乏味、费力的任务。计算机要完成诸如两数相加这样简单的事，就得分成类似以下
几个步骤。

1.	从内存位置 2000 上把一个数字拷贝到寄存器 1；

2.	从内存位置 2004 上把另一个数字拷贝到寄存器 2；

3.	把寄存器 2 中的内容与寄存器 1 中的内容相加，把结果储存在寄存器 1 中；

4.	把寄存器 1 中的内容拷贝到内存位置 2008；

然而，机器语言编程的黄金时代已一去不复返，不防试试高级编程语言。

## 高级计算机语言和编译器

高级编程语言（如，C）以多种方式简化了编程工作。首先，不必用数字码表示指令；其次，使用的指令更贴近你如何想这个问题，而不是类似计算机
那样繁琐的步骤。使用高级编程语言，可以在更抽象的层面表达想法，不用考虑 CPU 在完成任务时具体需要哪些步骤。例如，对于两数相加，可以
这样写：

```
total = mine + yours;
```

对我们而言，光看这行代码就知道要计算机做什么；而看机器语言写成的等价指令（多条以数字码形式表现的指令）则费劲得多。但是，对计算机而言
却恰恰相反。在计算机看来，高级指令就是一堆无法理解的无用数据。编译器在这里派上了用场。编译器是把高级语言程序翻译成计算机能理解的机器
语言指令集的程序。程序员进行高级思维活动，而编译器则负责处理冗长乏味的细节工作。

编译器还有一个优势。一般而言，不同 CPU 制造使用的指令系统和编码格式不同。但是，可以找到与特定类型 CPU 匹配的编译器。因此，使用合适的
编译器或编译器集，便可把一种高级语言程序转换成供不同类型 CPU 使用的机器语言程序。一旦解决了一个编程问题，便可让编译器集翻译成不同 CPU 
使用的机器语言。

简而言之，高级语言（如 C、Java、Pascal）以更抽象的方式描述行为，不受限于特定 CPU 或指令集。而且，高级语言简单易学，用高级语言编程比用
机器语言编程容易得多。


## 语言标准

目前，有许多 C 实现可用。在理想情况下，编写 C 程序时，假设该程序中未使用机器特定的编程技术，那么它的运行情况在任何实现中都应该相同。
要在实践中做到这一点，不同的实现要遵循同一个标准。

C 语言发展之初，并没有所谓的 C 标准。1987，布莱恩•柯林汉(Brian Kernighan)和丹尼斯•里奇(Dennis Ritchie)合著的`The C Programming Language(《C 语言程序设计》)`
第 1 版是公认的 C 标准，通常称之为`K&R C`或`经典 C`。特别是，该书中的附录中的"C 语言参考手册"已成为实现 C 的指导标准。虽然这本书中的
附录定义了 C 语言，但却没有定义 C 库。与大多数语言不同的是，C 语言比其他语言更依赖库，因此需要一个标准库。实际上，由于缺乏官方标准，
UNIX 实现提供的库已成为了标准库。

### 第 1 个 ANSI/ISO C 标准

随着 C 的不断发展，越来越广泛地应用于更多系统中，C 社区意识到需要一个更全面、更新颖、更严格的标准。鉴于此，美国国家标准协会(ANSI)开发
了一套新标准，于 1989 年正式公布。该标准(ANSI C)定义了 C 语言和 C 标准库。国际标准化组织于 1990 年采用了这套 C 标准(ISO C)。ISO C 和
ANSI C 是完全相同的标准。ANSI/ISO 标准的最终版本通常叫做 C89 或 C90，业界人士通常使用 ANSI C。

在该委员会制定的指导原则中，最有趣的可能是：保持 C 的精神。

*	信任程序员；

*	不要妨碍程序员做需要做的事；

*	保持语言精练简单；

*	只提供一种方法执行一项操作；

*	让程序运行更快，即使不能保证其可移植性。

### C99 标准

1994 年，ANSI/ISO 联合委员会(C9X 委员会)开始修订 C 标准，最终发布了 C99 标准。该委员会遵循了最初 C90 标准的原则，包括保持语言的精练简单。
委员会的用意不是在 C 语言中添加新特性，而是为了达到新的目标。

*   第 1 个目标是，支持国际化编程(国际化)；

*	第 2 个目标是，"调整现有实践致力于解决明显的缺陷"。因此，在遇到需要将 C 移至 64 位处理器时，委员会根据现实生活中处理问题的经验来添加标准(弥补缺陷)；

*	第 3 个目标是，为适应科学和工程项目中的关键数值计算，提高 C 的适应性，让 C 比 FORTRAN 更有竞争力(提高计算的实用性)。

C99 的修订保留了 C 语言的精髓，C 仍是一门简洁高效的语言。虽然该标准已发布了很长时间，但并非所有编译器都完全实现 C99 的所有改动。

### C11 标准

标准委员会在 2007 年承诺 C 标准的下一个版本是 C1X，2011 年终于发布了 C11 标准。出于对当前编程安全的担忧，不那么强调"信任程序员"目标了。
对于 C11 标准，浅尝辄止。


## 使用 C 语言的 7 个步骤

C 是编译型语言。

*   第 1 步：定义程序的目标

    在动手写程序之前，要在脑中在清晰的思路。想要程序去做什么首先要明确自己想做什么，思考你的程序需要哪些信息，要进行哪些计算和控制，以及
    程序应该要报告什么信息。在这一步骤中，不涉及具体的计算机语言，应该用一般术语来描述问题。

*   第 2 步：设计程序

    对程序应该完成什么任务有概念性的认识后，就应该考虑如何用程序来完成它。例如，用户界面应该是怎样的？如何组织程序？目标用户是谁？准备花
    多长时间来完成这个程序？

    除此之外，还要决定在程序（还可能是辅助文件）中如何表示数据，以及用什么方法处理数据。通常，选择一个合适的方式表示信息可以更容易地设计
    程序和处理数据。

    再次强调，应该用一般术语来描述问题，而不是用具体的代码。但是，某些决策可能取决于语言的特性。

*   第 3 步：编写代码

    设计好程序后，就可以编写代码来实现它。在这一步骤中，应该给自己编写的程序添加文字注释。

*   第 4 步：编译

    接下来的这一步是编译源代码。

    前面介绍过，编译器是把源代码转换成可执行代码的程序。`可执行代码`是用计算机的`机器语言`表示的代码。这种语言由数字码表示的指令组成。
    如前所述，不同的计算机使用不同的机器语言方案。C 编译器负责把 C 代码翻译成特定的机器语言。此外，C 编译器还将源代码与 C 库（库中包含
    大量的标准函数供用户使用，如 printf()）的代码合并成最终的程序（更精确地说，应该是由一个被称为`链接器`的程序来链接库函数，但是在大多数
    系统中，编译器运行链接器）。其结果是，生成一个用户可以运行的可执行文件，其中包含着计算机能理解的代码。

    编译器还会检查 C 语言程序是否有效。

*   第 5 步：运行程序

    传统上，可执行文件是可运行的程序。

*   第 6 步：测试和调试程序

    接下来，应该检查程序是否按照你所设计的思路运行。查找并修复程序错误的过程叫`调试`。

*   第 7 步：维护和修改代码

    创建完程序后，发现程序有错，或者想扩展程序的用途，这时就要修改程序。

### 说明

编程并非像描述那样是一个线性的过程。有时，要在不同的步骤之间往复。例如，写代码时发现之前的设计不切实际，或者想到了一个更好的解决方案。
对程序做文字注释为今后的修改提供了方便。

许多初学者经常忽略第 1 步和第 2 步（定义程序目标和设计程序），直接跳到第 3 步（编写代码）。刚开始学习时，编写的程序非常简单，完全可以
在脑中想象力好整个过程。即使写错了，也很容易发现。但是，随着编写的程序越来越大、越来越复杂，动脑不动手可不行，而且程序中隐藏的错误也
越来越难找。最终，跳过前两个步骤的人往往浪费更多时间，因为他们写出的程序难看、缺乏条理、让人难以理解。要编写的程序越大越复杂，事先定义
和设计程序一节的工作量就越大。


## 编程机制

用 C 语言编写程序时，编写的内容被储存在文本文件中，该文件被称为`源代码文件(source code file)`。大部分 C 系统，都要求文件名以`.c`结尾。
在文件名中，`.`前面的部分称为`基本名(basename)`，后面的部分称为`扩展名(extension)`。文件名应该满足特定计算机操作系统的特殊要求。例如
MS-DOS 要求基本名不能超过 8 个字符。Linux、Windows 和 Macintosh OS 都允许使用长文件名。

### 目标代码文件、可执行文件和库

C 编程的基本策略是，用程序把源代码文件转换为可执行文件（其中包含可直接运行的机器语言代码）。典型的 C 实现通过编译和链接两个步骤来完成
这一过程。编译器把源代码转换成中间代码，链接器把中间代码和其他代码合并，生成可执行文件。C 使用这种分而治之的方法方便对程序进行模块化，
可以独立编译单独的模块，稍后再用链接器合并已编译的模块。通过这种方式，如果只更改某个模块，不必因此重新编译其他模块。另外，链接器还将
你编写的程序和预编译的库代码合并。

中间文件有多种形式。这里描述最普遍的一种形式，即把源代码转换为机器语言代码，并把结果放在`目标代码文件`（或简称`目标文件`）中（这里假设
源代码只有一个文件）。虽然目标文件中包含机器语言代码，但是并不能直接运行该文件。因为目标文件中储存的是编译器翻译的源代码，这还不是一个
完整的程序。

目标代码文件缺失`启动代码(startup code)`。启动代码充当着程序和操作系统之间的接口。系统处理程序的方式不同，启动代码也不同。

目标代码还缺少库函数。几乎所有的 C 程序都要使用 C 标准库中的函数。目标代码文件并不包含库函数的代码，它只包含了使用库函数的指令。
库函数真正的代码储存在另一个被称为`库`的文件中。库文件中有许多函数的目标代码。

链接器的作用是，把你编写的目标代码、系统的标准启动代码和库代码这 3 部分合并成一个文件，即可执行文件。对于库代码，链接器只会把程序中要
用到的库函数提取出来。

简而言之，目标文件和可执行文件都由机器语言指令组成的。然而，目标文件中只包含编译器为你编写的代码翻译的机器语言代码，可执行文件中还包含
你编写的程序中使用的库函数和启动代码的机器代码。以下了解一些具体的系统。

### UNIX 系统

由于 C 语言因 UNIX 系统而生，也因此而流行，所以从 UNIX 系统开始。

#### 在 UNIX 系统中编辑

UNIX C 没有自己的编辑器，但是可以使用通知的 UNIX 编辑器，如 emacs、vi。

#### 在 UNIX 系统上编译

C 编译器会创建一个与源代码基本名相同的目标代码文件，但是其扩展名是`.o`。但是发现编译后找不到该文件，因为一旦链接器生成了完成的可执行
程序，就会将其删除。如果原始程序有多个源代码文件，则保留目标代码文件。学到后面多文件程序时，就会明白这样做的好处。

### GNU 编译器集合和 LLVM 项目

GNU 项目始于1987 年，是一个开发大量免费 UNIX 软件的集合（GNU 的意思是"GNU's Not UNIX"）。GNU 编译器集合（也被称为 GCC，其中包含 GCC C 编
译器）是该项目的产品之一。用`gcc`命令便可调用 GCC C 编译器。

LLVM 项目成为`cc`的另一个替代器。该项目是与编译器相关的开源软件集合。它的 Clang 编译器处理 C 代码，可以通过`clang`调用。

gcc 和 clang 命令都可以根据不同的版本选择运行时选项来调用不同 C 标准。

```
gcc -std=c99 test.c
gcc -std=c1x test.c
gcc -std=c11 test.c
```

### Linux 系统

Linux 是一个开源、流行、类似于 UNIX 的操作系统。使用 GNU 提供的 GCC 公共域 C 编译器。

### PC 的命令行编译器

C 编译器不是标准 Windows 软件包的一部分，因此需要从别处获取并安装 C 编译器。

### 集成开发环境(Windows)

### Windows/Linux

许多 Linux 发行版都可以安装在 Windows 系统中，以创建双系统。一些存储器会为 Linux 系统预留空间，以便可以启动 Windows 或 Linux。可以
在 Windows 系统中运行 Linux 程序，或在 Linux 系统中运行 Windows 程序。不能通过 Windows 系统访问 Linux 文件，但是可以通过 Linux 系统
访问 Windows 文档。

### Macintosh 中的 C

Xcode 允许用户选择不同的编程语言，包括 C 语言。

UNIX 系统内置 Mac OS X，终端工具打开的窗口是让用户在 UNIX 命令行环境中运行程序。


## 小结

C 是强大而简洁的编程语言。它之所以流行，在于自身提供大量的实用编程工具，能很好地控制硬件。而且，与大多数其他程序相比，C 程序更容易从
一个系统移植到另一个系统。

C 是编译型语言。C 编译器和链接器是把 C 语言源代码转换成可执行代码的程序。
