# 预处理器和 C 库

C 预处理器在程序执行之前查看程序（故称之为预处理器）。根据程序中的预处理器指令，预处理器把符号缩写替换成
其表示的内容。预处理器可以包含程序所需的其他文件，可以选择让编译器查看哪些代码。预处理器并不知道 C。
基本上它的工作是把一些文本转换成另外一些文本。貌似这样描述预处理器无法体现它的真正效用和价值。

## 翻译程序的第一步

在预处理之前，编译器必须对该程序进行一些翻译处理。

首先，编译器把源代码中出现的字符映射到源字符集。该过程处理多字节字符和三字符序列——字符扩展让 C 更加国际化。

第二，编译器定位每个反斜杠后面跟着换行符的实例，并删除它们。也就是说，把下面两个物理行(physical line)：

```
printf("That's wond\
        erful!\n");
```

转换成一个逻辑行(logical line)：

```
printf("That's wonderful!\n");
```

注意，在这种场合中，"换行符"的意思是通过按下 Enter 键在源代码文件中换行所生成的字符，而不是指符号表征`\n`。
由于预处理表达式的长度必须是一个逻辑行，所以这一步为预处理器做好了准备工作。一个逻辑行可以是多个物理行。

第三，编译器把文本划分成预处理记号序列、空白序列和注释序列（记号是由空格、制表符或换行符分隔的项）。
这里要注意的是，编译器将用一个空格字符替换每一条注释。因此，下面的代码：

```
int/* 这看起来并不像一个空格 */fox;
```

将变成：

```
int fox;
```

而且，实现可以用一个空格替换所有的空白字符序列（不包括换行符）。最后，程序已经准备好进入预处理阶段，预处理器查找
一行中以 # 号开始的预处理指令。


## 明示常量：#define

`#define`预处理器指令和其他预处理器指令一样，以`#`号作为一行的开始。ANSI 和后来的标准都允许`#`号前面有空格或制表符，
而且还允许在`#`和指令的其余部分之间有空格。指令可以出现在源文件的任何地方，其定义从指令出现的地方到该文件末尾有效。
我们大量使用`#define`指令来定义 **明示常量(manifest constant)**（也叫做符号常量），但是该指令还有许多其他用途。
预处理指令从`#`开始运行，到后面的第 1 个换行符为止。也就是指令的长度仅限于一行（逻辑行）。

演示代码：preproc.c

每行`#define`（逻辑行）都由 3 部分组成。
1. `#define`指令本身；
2. 选定的缩写，也称为 **宏**，有些宏代表值，这些宏被称为 **类对象宏(object-like macro)**，还有 **类函数宏(function-like macro)**，
   宏的名称中不允许有空格，必须遵循 C 变量的命名规则；
3. 指令行的其余部分称为 **替换列表** 或 **替换体**；

一旦预处理器在程序中找到宏的实例后，就会用替换体代替宏（也有例外）。从宏变成最终替换文本的过程称为 **宏展开(macro expansion)**。
预处理器不做计算，不对表达式求值，它只进行替换。

### 记号

从技术角度来看，可以把宏的替换体看作是 **记号(token)** 型字符串，而不是字符型字符串。
